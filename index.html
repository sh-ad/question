<!doctype html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞ –ø–æ Database Internals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: dark;
      --bg: #030712;
      --bg-elevated: rgba(10, 14, 30, 0.78);
      --bg-card: rgba(13, 18, 35, 0.86);
      --border-subtle: rgba(120, 156, 255, 0.18);
      --border-strong: rgba(255, 255, 255, 0.08);
      --accent: #6dd3ff;
      --accent-2: #7c3aed;
      --accent-3: #22d3ee;
      --accent-alt: #fbbf24;
      --glow: rgba(109, 211, 255, 0.35);
      --text-main: #eef2ff;
      --text-muted: #c7d2fe;
      --text-soft: #9ca3af;
      --shadow-strong: 0 24px 80px rgba(0, 0, 0, 0.55), 0 0 0 1px rgba(255, 255, 255, 0.04);
    }

    * {
      box-sizing: border-box;
    }

    @font-face {
      font-family: "Space Grotesk";
      src: url("./fonts/SpaceGrotesk-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Space Grotesk";
      src: url("./fonts/SpaceGrotesk-Medium.ttf") format("truetype");
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Space Grotesk";
      src: url("./fonts/SpaceGrotesk-SemiBold.ttf") format("truetype");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Space Grotesk";
      src: url("./fonts/SpaceGrotesk-Bold.ttf") format("truetype");
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Manrope";
      src: url("./fonts/Manrope-Regular.ttf") format("truetype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Manrope";
      src: url("./fonts/Manrope-Medium.ttf") format("truetype");
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: "Manrope";
      src: url("./fonts/Manrope-SemiBold.ttf") format("truetype");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      font-family: "Space Grotesk", "Manrope", "DM Sans", "SF Pro Display", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: radial-gradient(circle at 20% 20%, rgba(109, 211, 255, 0.08), transparent 30%),
        radial-gradient(circle at 80% 0%, rgba(124, 58, 237, 0.12), transparent 40%),
        radial-gradient(circle at 60% 80%, rgba(34, 211, 238, 0.12), transparent 35%),
        #01030a;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 22px 18px 26px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -30%;
      background:
        radial-gradient(circle at 30% 30%, rgba(109, 211, 255, 0.12), transparent 40%),
        radial-gradient(circle at 80% 20%, rgba(124, 58, 237, 0.12), transparent 35%),
        radial-gradient(circle at 20% 70%, rgba(34, 211, 238, 0.12), transparent 35%);
      filter: blur(40px);
      opacity: 0.9;
      z-index: -2;
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0));
      mix-blend-mode: screen;
      pointer-events: none;
      z-index: -1;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.04);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #6dd3ff, #7c3aed);
      border-radius: 999px;
    }

    .app {
      max-width: 1100px;
      width: 100%;
      background: linear-gradient(135deg, rgba(13, 18, 35, 0.9), rgba(7, 12, 24, 0.9));
      border-radius: 20px;
      padding: 26px 22px 30px;
      box-shadow: var(--shadow-strong), 0 0 80px rgba(109, 211, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.06);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .app::before {
      content: "";
      position: absolute;
      inset: -50%;
      background:
        radial-gradient(circle at 10% 10%, rgba(109, 211, 255, 0.25), transparent 50%),
        radial-gradient(circle at 90% 20%, rgba(124, 58, 237, 0.25), transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(34, 211, 238, 0.25), transparent 50%);
      opacity: 0.5;
      pointer-events: none;
      z-index: -2;
      filter: blur(40px);
    }

    .app::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(160deg, rgba(255, 255, 255, 0.06), transparent 35%);
      opacity: 0.7;
      pointer-events: none;
      z-index: -1;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(109, 211, 255, 0.18), rgba(124, 58, 237, 0.26));
      border: 1px solid rgba(255, 255, 255, 0.14);
      color: #e0e7ff;
      text-transform: uppercase;
      letter-spacing: 0.2em;
    }

    .subtitle {
      margin-bottom: 16px;
      font-size: 15px;
      color: var(--text-muted);
      max-width: 720px;
      line-height: 1.6;
    }

    .badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
      font-size: 11px;
    }

    .badge {
      border-radius: 999px;
      padding: 5px 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.02));
      color: var(--text-main);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }

    .badge-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 10px;
    }

    .badge strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 12px;
      align-items: center;
      margin-bottom: 18px;
    }

    .controls-main {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      flex: 1 1 auto;
      min-width: 220px;
    }

    .controls-secondary {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      font-size: 12px;
      color: var(--text-soft);
    }

    button {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.02em;
      background: linear-gradient(135deg, #6dd3ff, #7c3aed);
      color: #041018;
      box-shadow: 0 16px 40px rgba(109, 211, 255, 0.4);
      transition:
        transform 0.12s ease-out,
        box-shadow 0.12s ease-out,
        background 0.12s ease-out,
        filter 0.12s ease-out;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 50px rgba(124, 58, 237, 0.48);
      background: linear-gradient(135deg, #7c3aed, #6dd3ff);
      filter: brightness(1.05);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(109, 211, 255, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
      color: var(--text-main);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.08);
      font-weight: 600;
      padding-inline: 16px;
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06));
      box-shadow: 0 8px 28px rgba(124, 58, 237, 0.35);
      filter: none;
    }

    .btn-ghost {
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-soft);
      box-shadow: none;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      font-size: 13px;
      font-weight: 600;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-main);
      box-shadow: 0 12px 24px rgba(109, 211, 255, 0.25);
    }

    .btn-icon {
      font-size: 16px;
      line-height: 1;
    }

    .control-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-main);
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
      white-space: nowrap;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
    }

    .control-inline span {
      white-space: nowrap;
    }

    input[type="text"] {
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-main);
      font-size: 12px;
      padding: 7px 12px;
      outline: none;
      min-width: 160px;
    }

    input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(109, 211, 255, 0.35);
    }

    .range-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      min-width: 180px;
    }

    input[type="range"] {
      appearance: none;
      -webkit-appearance: none;
      width: 90px;
      height: 4px;
      border-radius: 999px;
      background: #111827;
      outline: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6dd3ff, #7c3aed);
      box-shadow: 0 0 0 2px #041018, 0 0 0 6px rgba(109, 211, 255, 0.25);
      border: none;
      margin-top: -5px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6dd3ff, #7c3aed);
      border: none;
      box-shadow: 0 0 0 2px #041018, 0 0 0 6px rgba(109, 211, 255, 0.25);
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      border-radius: 999px;
      background: #111827;
    }

    input[type="range"]::-moz-range-track {
      height: 4px;
      border-radius: 999px;
      background: #111827;
    }

    .range-value {
      font-variant-numeric: tabular-nums;
      color: var(--text-muted);
    }

    .ticket-meta {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .ticket-meta span {
      opacity: 0.9;
    }

    #ticketContainer {
      margin-top: 18px;
      min-height: 80px;
    }

    .blocks {
      margin-top: 2px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
      animation: fadeInUp 0.22s ease-out;
    }

    .block-card {
      background: linear-gradient(140deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
      border-radius: 16px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.5), 0 0 40px rgba(109, 211, 255, 0.08);
      position: relative;
      overflow: hidden;
      transform-origin: top left;
      animation: cardPopIn 0.25s ease-out;
      backdrop-filter: blur(6px);
    }

    .block-card::before {
      content: "";
      position: absolute;
      inset: -35%;
      background:
        radial-gradient(circle at 0% 0%, rgba(109, 211, 255, 0.3), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(124, 58, 237, 0.25), transparent 60%),
        radial-gradient(circle at 40% 90%, rgba(34, 211, 238, 0.2), transparent 55%);
      opacity: 0.4;
      pointer-events: none;
      mix-blend-mode: screen;
    }

    .block-inner {
      position: relative;
      z-index: 1;
    }

    .block-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      margin-bottom: 4px;
    }

    .block-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
    }

    .block-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(109, 211, 255, 0.16);
      color: #bde5ff;
    }

    .block-tag-badge {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(109, 211, 255, 0.2);
    }

    .block-subtitle {
      font-size: 11px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 6px;
    }

    .question-text {
      font-size: 13px;
      line-height: 1.45;
      color: #e5e7eb;
    }

    .question-number {
      font-weight: 600;
      color: #a5b4fc;
      margin-right: 4px;
    }

    .empty-state {
      margin-top: 8px;
      font-size: 14px;
      color: var(--text-muted);
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px dashed var(--border-subtle);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.015));
    }

    .hint {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .hint strong {
      color: #c7d2fe;
    }

    .history {
      margin-top: 18px;
      padding-top: 12px;
      border-top: 1px solid var(--border-subtle);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0));
      border-radius: 14px;
      padding: 12px;
    }

    .history-title {
      font-size: 11px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 6px;
    }

    .history-empty {
      font-size: 12px;
      color: var(--text-soft);
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
      max-height: 240px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .history-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.25);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .history-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .history-item-title {
      font-weight: 600;
      color: var(--text-main);
    }

    .history-item-time {
      color: var(--text-muted);
    }

    .history-item-mode {
      color: #a5b4fc;
      font-size: 11px;
    }

    .history-item-blocks {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .history-pill {
      border-radius: 999px;
      padding: 2px 7px;
      background: rgba(15, 118, 110, 0.18);
      color: #67e8f9;
    }

    .history-item-name {
      color: #c7d2fe;
      font-weight: 600;
    }

    .history-rename-btn {
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.7);
      color: var(--text-soft);
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 11px;
      cursor: pointer;
      transition: background 0.12s ease-out, color 0.12s ease-out, border-color 0.12s ease-out;
    }

    .history-rename-btn:hover {
      background: rgba(109, 211, 255, 0.12);
      color: var(--text-main);
      border-color: rgba(109, 211, 255, 0.5);
    }

    .all-questions {
      margin-top: 16px;
      padding: 10px 10px 8px;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      font-size: 13px;
      color: var(--text-muted);
    }

    .all-questions summary {
      list-style: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      outline: none;
    }

    .all-questions summary::-webkit-details-marker {
      display: none;
    }

    .all-questions-toggle {
      font-weight: 500;
      color: var(--text-main);
    }

    .all-questions-arrow {
      font-size: 14px;
      opacity: 0.7;
      transition: transform 0.15s ease-out;
    }

    .all-questions[open] .all-questions-arrow {
      transform: rotate(90deg);
    }

    .all-questions-content {
      margin-top: 8px;
      max-height: 260px;
      overflow: auto;
      padding-right: 2px;
    }

    .all-questions-block {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed rgba(55, 65, 81, 0.8);
    }

    .all-questions-block:first-child {
      border-top: none;
      padding-top: 0;
      margin-top: 4px;
    }

    .all-questions-block-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
      color: var(--text-main);
    }

    .all-questions-list {
      margin: 0;
      padding-left: 18px;
    }

    .all-questions-list li {
      margin-bottom: 2px;
      line-height: 1.4;
    }

    .question-number-tag {
      color: #a5b4fc;
      font-weight: 500;
      margin-right: 4px;
    }

    /* –†—É–ª–µ—Ç–∫–∞ */

    .roulette-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 30% 30%, rgba(109, 211, 255, 0.08), transparent 40%),
        radial-gradient(circle at 70% 20%, rgba(124, 58, 237, 0.12), transparent 45%),
        rgba(4, 6, 14, 0.82);
      backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 16px;
      animation: overlayFadeIn 0.18s ease-out;
    }

    .roulette-overlay-fade-out {
      animation: overlayFadeOut 0.16s ease-in forwards;
    }

    .roulette-panel {
      max-width: 960px;
      width: 100%;
      background: linear-gradient(135deg, rgba(13, 18, 35, 0.9), rgba(7, 12, 24, 0.92));
      border-radius: 18px;
      padding: 16px 16px 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 24px 70px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(109, 211, 255, 0.08);
      display: flex;
      flex-direction: column;
      gap: 10px;
      backdrop-filter: blur(10px);
    }

    .roulette-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      flex-wrap: wrap;
    }

    .roulette-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .roulette-title span {
      font-size: 18px;
    }

    .roulette-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .roulette-subtitle strong {
      color: #c7d2fe;
    }

    .roulette-progress {
      min-width: 170px;
    }

    .progress-label {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 3px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .progress-label span {
      font-variant-numeric: tabular-nums;
    }

    .progress-bar {
      position: relative;
      width: 100%;
      height: 5px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.04);
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(30, 64, 175, 0.5);
    }

    .progress-inner {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), var(--accent-alt));
      transform-origin: left center;
      transform: scaleX(1);
      transition: transform 0.04s linear;
    }

    .roulette-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 8px;
      max-height: 320px;
      overflow-y: auto;
      overflow-x: hidden;
      margin-top: 6px;
      padding-right: 2px;
    }

    .mini-ticket {
      min-width: 0;
      border-radius: 10px;
      padding: 8px 7px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
      font-size: 11px;
      color: var(--text-muted);
      opacity: 0.75;
      transform: translateY(0);
      transition:
        background 0.12s ease-out,
        border-color 0.12s ease-out,
        box-shadow 0.12s ease-out,
        transform 0.12s ease-out,
        opacity 0.12s ease-out;
    }

    .mini-ticket-title {
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 2px;
      font-size: 11px;
    }

    .mini-ticket-blocks {
      color: #a5b4fc;
      margin-bottom: 1px;
    }

    .mini-ticket-questions {
      font-size: 11px;
      color: var(--text-muted);
    }

    .mini-ticket.is-hot {
      border-color: rgba(109, 211, 255, 0.7);
      background: radial-gradient(circle at top left, rgba(109, 211, 255, 0.18), rgba(124, 58, 237, 0.08));
      box-shadow:
        0 0 0 1px rgba(109, 211, 255, 0.65),
        0 12px 30px rgba(124, 58, 237, 0.35);
      transform: translateY(-1px) scale(1.02);
      opacity: 1;
    }

    .roulette-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .roulette-actions-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .roulette-hint {
      font-size: 11px;
      color: var(--text-soft);
      max-width: 360px;
    }

    .roulette-stage-label {
      font-size: 12px;
      color: var(--text-soft);
      margin: -2px 0 2px;
    }

    .roulette-picked {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--text-soft);
      min-height: 12px;
    }

    .roulette-picked-pill {
      border-radius: 999px;
      padding: 3px 8px;
      background: rgba(109, 211, 255, 0.12);
      border: 1px solid rgba(109, 211, 255, 0.35);
      color: #dbeafe;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .roulette-picked-pill strong {
      color: #c7d2fe;
      font-weight: 600;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes cardPopIn {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.97);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes overlayFadeIn {
      from {
        opacity: 0;
        transform: scale(1.02);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes overlayFadeOut {
      from {
        opacity: 1;
        transform: scale(1);
      }

      to {
        opacity: 0;
        transform: scale(1.02);
      }
    }

    @media (max-width: 700px) {
      .app {
        padding: 18px 12px 22px;
        border-radius: 14px;
      }

      h1 {
        font-size: 20px;
        flex-direction: column;
        align-items: flex-start;
      }

      .controls {
        flex-direction: column;
        align-items: flex-start;
      }

      .controls-secondary {
        width: 100%;
        justify-content: space-between;
      }

      .control-inline {
        width: 100%;
        justify-content: space-between;
      }

      .range-wrapper {
        width: 100%;
      }

      .roulette-panel {
        padding: 14px 10px 12px;
      }

      .roulette-grid {
        max-height: 320px;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <h1>
      –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –±–∏–ª–µ—Ç–∞ –ø–æ Database Internals
      <span class="title-pill">exam mode</span>
    </h1>

    <div class="subtitle">
      –ù–∞–∂–º–∏ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é¬ª, —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –±–∏–ª–µ—Ç –∏–∑ 3 —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤ –∏ 3 –≤–æ–ø—Ä–æ—Å–æ–≤:
      —Ö—Ä–∞–Ω–µ–Ω–∏–µ/—Å—Ç—Ä–∞–Ω–∏—Ü—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
    </div>

    <div class="badges" id="statsBadges"></div>

    <div class="controls">
      <div class="controls-main">
        <button id="generateBtn">
          <span class="btn-icon">üé≤</span>
          <span>–ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</span>
        </button>

        <div class="control-inline">
          <span>–ù–∞–∑–≤–∞–Ω–∏–µ</span>
          <input type="text" id="ticketNameInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –ò–≤–∞–Ω–æ–≤" maxlength="80">
        </div>
      </div>

      <div class="controls-secondary">
        <div class="control-inline" id="durationControl">
          <span>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä—É–ª–µ—Ç–∫–∏</span>
          <div class="range-wrapper">
            <input type="range" id="durationRange" min="2" max="10" step="1" value="5">
            <span class="range-value"><span id="durationLabel">5</span> —Å</span>
          </div>
        </div>
        <button class="btn-secondary" id="instantBtn" title="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ä—É–ª–µ—Ç–∫–∏">
          <span class="btn-icon">‚ö°</span>
          –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ
        </button>
      </div>
    </div>

    <div class="ticket-meta" id="ticketMeta">
      <span>–ë–∏–ª–µ—Ç –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ.</span>
    </div>

    <div id="ticketContainer">
      <div class="empty-state">
        –ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã. –ö–∞–∂–¥—ã–π –±–∏–ª–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç 3 –±–ª–æ–∫–∞ –∏ 3 –≤–æ–ø—Ä–æ—Å–∞.
      </div>
    </div>

    <div class="hint">
      –ù—É–º–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–∏–¥–∞ <strong>X.Y</strong> —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º–æ–π –∏ –Ω–æ–º–µ—Ä–æ–º –≤–æ–ø—Ä–æ—Å–∞
      –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —ç–∫–∑–∞–º–µ–Ω–∞ –≤ –≤–∏–∫–∏ (X ‚Äî –Ω–æ–º–µ—Ä —Ç–µ–º—ã, Y ‚Äî –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞).
    </div>

    <div class="history">
      <div class="history-title">–ò—Å—Ç–æ—Ä–∏—è –±–∏–ª–µ—Ç–æ–≤ –∑–∞ —ç—Ç—É —Å–µ—Å—Å–∏—é</div>
      <div class="history-empty" id="historyEmpty">
        –ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–ø–∞–ª–æ ‚Äî –ø–µ—Ä–≤—ã–π –±–∏–ª–µ—Ç —Å—Ç–∞–Ω–µ—Ç #1.
      </div>
      <div class="history-list" id="historyList"></div>
    </div>

    <details class="all-questions">
      <summary>
        <span class="all-questions-toggle">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±–ª–æ–∫–∏ –∏ –≤–æ–ø—Ä–æ—Å—ã</span>
        <span class="all-questions-arrow">‚ñ∂</span>
      </summary>
      <div class="all-questions-content" id="allQuestionsContent"></div>
    </details>
  </div>

  <script>
    // –û–ø–∏—Å–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è Database Internals
    // –ù—É–º–µ—Ä–∞—Ü–∏—è X.Y: X ‚Äî —Ç–µ–º–∞, Y ‚Äî –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ –≤ —Ç–µ–º–µ

    const blocks = [
      {
        id: "A",
        name: "–ë–ª–æ–∫ A ‚Äî –°—Ç—Ä–∞–Ω–∏—Ü–∞, –±—É—Ñ–µ—Ä–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä, –∫–∞—Ç–∞–ª–æ–≥–∏ (–¢–µ–º—ã 1‚Äì3)",
        questions: [
          // –¢–µ–º–∞ 1. Architecture. Page layout
          { number: "1.1", text: "SQL-–∑–∞–ø—Ä–æ—Å: –ø—É—Ç—å —á–µ—Ä–µ–∑ —É—Ä–æ–≤–Ω–∏ –°–£–ë–î –æ—Ç —Å—Ç—Ä–æ–∫–∏ –¥–æ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥–∏—Å–∫–∞." },
          { number: "1.2", text: "–ó–∞—á–µ–º –°–£–ë–î –≤–≤–æ–¥–∏—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (8/16 –ö–ë) –ø–æ–≤–µ—Ä—Ö –±–ª–æ–∫–æ–≤ –û–°?" },
          { number: "1.3", text: "–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã lower/upper/slotCount –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ lower > upper?" },
          { number: "1.4", text: "–†–æ–ª—å –º–∞—Å—Å–∏–≤–∞ —Å–ª–æ—Ç–æ–≤. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å tuple –ø—Ä–∏ soft delete –∏ –ø–æ—á–µ–º—É –Ω–µ —É–¥–∞–ª—è–µ–º —Å—Ä–∞–∑—É?" },
          { number: "1.5", text: "–ó–∞—á–µ–º –Ω—É–∂–µ–Ω nullmask –≤–Ω—É—Ç—Ä–∏ tuple? –†–∞–∑–Ω–∏—Ü–∞ NULL –∏ \"\" –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è." },

          // –¢–µ–º–∞ 2. Shared buffers / Buffer Manager
          { number: "2.1", text: "–ó–∞—á–µ–º –≤ –°–£–ë–î –Ω—É–∂–µ–Ω –±—É—Ñ–µ—Ä–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –≤–æ–æ–±—â–µ?" },
          { number: "2.2", text: "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: cache hit vs cache miss?" },
          { number: "2.3", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ Buffer Pool –∏ –∫–∞–∫–∏–µ —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –æ–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ PostgreSQL?" },
          { number: "2.4", text: "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ FIFO, LRU –∏ Clock: –∏–¥–µ—è, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –ø—Ä–∞–∫—Ç–∏–∫–∞." },
          { number: "2.5", text: "Clock-sweep –≤ PostgreSQL: usage_count –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ." },
          { number: "2.6", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ dirty-—Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫–æ–≥–¥–∞ –æ–Ω–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏ –ø–æ—á–µ–º—É –Ω–µ –ø–∏—à–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ —Å—Ä–∞–∑—É?" },
          { number: "2.7", text: "–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Background Writer –∏ Checkpointer –≤ PostgreSQL –∏ –∏—Ö –∑–∞–¥–∞—á–∏." },

          // –¢–µ–º–∞ 3. Catalog Management
          { number: "3.1", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ–Ω–µ–¥–∂–µ—Ä –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ –∑–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ Catalog Manager?" },
          { number: "3.2", text: "–ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∏ –ø–æ—á–µ–º—É –ë–î –Ω–∞–∑—ã–≤–∞—é—Ç —Å–∞–º–æ–æ–ø–∏—Å—ã–≤–∞—é—â–µ–π—Å—è?" },
          { number: "3.3", text: "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–∞—Ö: —Å—Ö–µ–º—ã, —Ç–∞–±–ª–∏—Ü—ã, —Å—Ç–æ–ª–±—Ü—ã, —Ç–∏–ø—ã." },
          { number: "3.4", text: "–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç –∫–∞—Ç–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü (pg_class) –∏ –∫–∞–∫ –æ–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∏–º—è —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏?" },
          { number: "3.5", text: "–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç –∫–∞—Ç–∞–ª–æ–≥ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (pg_attribute) –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?" },
          { number: "3.6", text: "–ö–∞–∫ Catalog Manager —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Buffer Manager –∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤?" }
        ]
      },
      {
        id: "B",
        name: "–ë–ª–æ–∫ B ‚Äî –ü–∞—Ä—Å–∏–Ω–≥, –ø–ª–∞–Ω—ã, join‚Äô—ã, –∏–Ω–¥–µ–∫—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä (–¢–µ–º—ã 4‚Äì9)",
        questions: [
          // –¢–µ–º–∞ 4. AST –∏ SQL Parsing
          { number: "4.1", text: "–¢—Ä–∏ —ç—Ç–∞–ø–∞ SQL-–ø–∞—Ä—Å–∏–Ω–≥–∞: Lexer, Parser, Semantic Analyzer –∏ –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã." },
          { number: "4.2", text: "–ß–µ–º AST –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Query Tree –∏ –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Ö–æ–¥?" },
          { number: "4.3", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç–æ–∫–µ–Ω –∏ –∫–∞–∫ –ª–µ–∫—Å–µ—Ä –≤—ã–¥–µ–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ SELECT-–∑–∞–ø—Ä–æ—Å–∞?" },
          { number: "4.4", text: "–ü–æ—á–µ–º—É AST –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –¥–µ—Ä–µ–≤–æ–º, –∞ –Ω–µ –ª–∏–Ω–µ–π–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é?" },
          { number: "4.5", text: "–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã —É–∑–ª–æ–≤ AST –¥–ª—è SQL (SelectStmt, RangeVar, AExpr –∏ –¥—Ä.)." },
          { number: "4.6", text: "–ö–∞–∫ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –¥–µ—Ä–µ–≤–∞ WHERE (AND/OR)?" },
          { number: "4.7", text: "–ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è AExpr –∏ BoolExpr –∏ –∫–∞–∫ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏?" },
          { number: "4.8", text: "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–æ—Å–ª–µ AST –∏ –∫–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –æ–Ω –ª–æ–≤–∏—Ç?" },

          // –¢–µ–º–∞ 5. –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∏ –±–∞–∑–æ–≤—ã–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏
          { number: "5.1", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ Planner –∏ –∫–∞–∫—É—é –∑–∞–¥–∞—á—É –æ–Ω —Ä–µ—à–∞–µ—Ç –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –°–£–ë–î?" },
          { number: "5.2", text: "–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ª–æ–≥–∏—á–µ—Å–∫–∏–º –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –ø–ª–∞–Ω–æ–º. –ü—Ä–∏–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä." },
          { number: "5.3", text: "–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –¥–ª—è SELECT name FROM users WHERE age > 18?" },
          { number: "5.4", text: "–ó–∞—á–µ–º –≤—ã–¥–µ–ª—è—Ç—å Planner –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç Optimizer –∏ Executor?" },
          { number: "5.5", text: "–†–æ–ª—å Optimizer –∏ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Planner." },
          { number: "5.6", text: "–ò—Ç–µ—Ä–∞—Ç–æ—Ä–Ω–∞—è (Volcano) –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π: –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑—É–µ—Ç Executor?" },
          { number: "5.7", text: "–ü–æ—á–µ–º—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞—é—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Decorator? –ü—Ä–∏–º–µ—Ä —Ü–µ–ø–æ—á–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π." },

          // –¢–µ–º–∞ 6. JOIN –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
          { number: "6.1", text: "–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –≤ INNER JOIN, –µ—Å–ª–∏ —É —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–≤–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å–ø—Ä–∞–≤–∞?" },
          { number: "6.2", text: "–ü–æ–≤–µ–¥–µ–Ω–∏–µ LEFT JOIN, –µ—Å–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–≤–∞ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å–ø—Ä–∞–≤–∞." },
          { number: "6.3", text: "–ò–¥–µ—è Nested Loop Join: –ø–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã." },
          { number: "6.4", text: "–ê—Å–∏–º–ø—Ç–æ—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å NLJ –∏ –æ—Ç —á–µ–≥–æ –æ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç." },
          { number: "6.5", text: "–ö–∞–∫ –≤—ã–±–æ—Ä outer –∏ inner —Ç–∞–±–ª–∏—Ü—ã –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å NLJ?" },
          { number: "6.6", text: "–ö–∞–∫ NLJ –≤—ã–≥–ª—è–¥–∏—Ç –≤ Volcano/Iterator –º–æ–¥–µ–ª–∏ (open/next/close) –∏ –¥–µ—Ä–µ–≤–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π?" },
          { number: "6.7", text: "–ß–µ–º Nested Loop Join –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Sort-Merge –∏ Hash Join?" },

          // –¢–µ–º–∞ 7. Hash –∏–Ω–¥–µ–∫—Å—ã
          { number: "7.1", text: "–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã hash-–∏–Ω–¥–µ–∫—Å–∞: bucket –ø–æ –∫–ª—é—á—É, —Ä–æ–ª—å hash-—Ñ—É–Ω–∫—Ü–∏–∏, TID/ctid." },
          { number: "7.2", text: "–¢–∏–ø—ã —Å—Ç—Ä–∞–Ω–∏—Ü hash-–∏–Ω–¥–µ–∫—Å–∞: –º–µ—Ç–∞—Å—Ç—Ä–∞–Ω–∏—Ü–∞, bucket, overflow, bitmap." },
          { number: "7.3", text: "–ó–∞—á–µ–º –Ω—É–∂–Ω—ã overflow-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∫–∞–∫ –æ–Ω–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É bucket?" },
          { number: "7.4", text: "Linear hashing –≤ hash-–∏–Ω–¥–µ–∫—Å–µ: highmask, lowmask, max_bucket." },
          { number: "7.5", text: "–í—Å—Ç–∞–≤–∫–∞ –≤ hash-–∏–Ω–¥–µ–∫—Å: –æ—Ç –∫–ª—é—á–∞ –¥–æ (hash, TID) –Ω–∞ –Ω—É–∂–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ." },
          { number: "7.6", text: "–ü–æ–∏—Å–∫ –ø–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤—É –≤ hash-–∏–Ω–¥–µ–∫—Å–µ –∏ –ø–æ—á–µ–º—É —Å–ª–æ–∂–Ω–æ—Å—Ç—å –±–ª–∏–∑–∫–∞ –∫ O(1)." },
          { number: "7.7", text: "–ü–æ—á–µ–º—É hash-–∏–Ω–¥–µ–∫—Å lossy –∏ –∑–∞—á–µ–º recheck —É—Å–ª–æ–≤–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã?" },

          // –¢–µ–º–∞ 8. B+-Tree –∏–Ω–¥–µ–∫—Å
          { number: "8.1", text: "–ß–µ–º B+-tree –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç hash-–∏–Ω–¥–µ–∫—Å–∞ –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ range-–∑–∞–ø—Ä–æ—Å–æ–≤?" },
          { number: "8.2", text: "Internal vs leaf —É–∑–ª—ã B+-tree –∏ –∑–∞—á–µ–º –ª–∏—Å—Ç—å—è —Å–≤—è–∑—ã–≤–∞—é—Ç —á–µ—Ä–µ–∑ sibling-—Å—Å—ã–ª–∫–∏?" },
          { number: "8.3", text: "–ü–æ–∏—Å–∫ –∫–ª—é—á–∞ –≤ B+-tree: –æ—Ç –∫–æ—Ä–Ω—è –¥–æ –ª–∏—Å—Ç–∞; –∫–∞–∫ –¥–µ–ª–∞—Ç—å range scan [from, to]." },
          { number: "8.4", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Ä—è–¥–æ–∫ –¥–µ—Ä–µ–≤–∞ t –∏ –∫–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–Ω –∑–∞–¥–∞—ë—Ç –Ω–∞ —á–∏—Å–ª–æ –∫–ª—é—á–µ–π?" },
          { number: "8.5", text: "–ß–µ–º split –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É–∑–ª–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç split –ª–∏—Å—Ç–∞?" },

          // –¢–µ–º–∞ 9. –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä
          { number: "9.1", text: "–ó–∞—á–µ–º –Ω—É–∂–µ–Ω Optimizer, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å Planner –∏ Executor?" },
          { number: "9.2", text: "–ö–∞–∫ –∏–∑ –æ–¥–Ω–æ–≥–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–ª–∞–Ω–∞?" },
          { number: "9.3", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ cost model PostgreSQL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã seq_page_cost, random_page_cost, cpu_tuple_cost, cpu_operator_cost?" },
          { number: "9.4", text: "–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å Hash Join (build/probe, startup cost, total cost)?" },
          { number: "9.5", text: "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç ANALYZE / auto-analyze –∏ –∫–∞–∫ –ø–ª–æ—Ö–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç–∏—Ç –ø–ª–∞–Ω?" },
          { number: "9.6", text: "EXPLAIN vs EXPLAIN ANALYZE: —á—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç cost, rows, width, actual time, rows, loops?" }
        ]
      },
      {
        id: "C",
        name: "–ë–ª–æ–∫ C ‚Äî –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, WAL, CLI –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–¢–µ–º—ã 10‚Äì11)",
        questions: [
          // –¢–µ–º–∞ 10. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
          { number: "10.1", text: "–ö–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –Ω—É–∂–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ MVCC?" },
          { number: "10.2", text: "–§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∫–∞–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π." },
          { number: "10.3", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ WAL, –∫–∞–∫ –æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å/–¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å –∏ –∫–∞–∫ —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏?" },
          { number: "10.4", text: "–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫." },
          { number: "10.5", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ deadlock (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞) –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π?" },
          { number: "10.6", text: "–ß–µ—Ä–µ–∑ –∫–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ?" },

          // –¢–µ–º–∞ 11. CLI –∏ —Å–æ–∫–µ—Ç—ã
          { number: "11.1", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–∫–µ—Ç –≤ –∫–ª–∏–µ–Ω—Ç‚Äì—Å–µ—Ä–≤–µ—Ä–Ω–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –∏ —Ä–æ–ª—å —Å–æ–∫–µ—Ç–æ–≤ –¥–ª—è PostgreSQL?" },
          { number: "11.2", text: "–†–æ–ª—å –ø—Ä–æ—Ü–µ—Å—Å–∞ postmaster –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è." },
          { number: "11.3", text: "–ß—Ç–æ —Ç–∞–∫–æ–µ backend-–ø—Ä–æ—Ü–µ—Å—Å PostgreSQL –∏ –∫–∞–∫ –æ–Ω —Å–≤—è–∑–∞–Ω —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º?" },
          { number: "11.4", text: "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: –æ—Ç connect() –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è backend-–ø—Ä–æ—Ü–µ—Å—Å–∞ (–ø–æ —à–∞–≥–∞–º)." },
          { number: "11.5", text: "–ß–µ–º —Å–µ—Å—Å–∏—è –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ PostgreSQL? –ö–æ—Ä–æ—Ç–∫–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è." },
          { number: "11.6", text: "–ü–æ—á–µ–º—É –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (max_connections ‚â´ 100) –ø–ª–æ—Ö–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞?" }
        ]
      }
    ];

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ
    let currentTicket = null;
    let currentTicketName = "";
    let currentTicketInfo = null;
    let ticketCounter = 0;
    const ticketHistory = [];
    let rouletteState = null;

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, (ch) => {
        switch (ch) {
          case "&": return "&amp;";
          case "<": return "&lt;";
          case ">": return "&gt;";
          case '"': return "&quot;";
          case "'": return "&#39;";
          default: return ch;
        }
      });
    }

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ (Fisher‚ÄìYates)
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // *** –°–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω –±–∏–ª–µ—Ç:
    // –≤—Å–µ–≥–¥–∞ –±–µ—Ä—ë–º –≤—Å–µ –±–ª–æ–∫–∏ A, B, C,
    // –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ç–µ–º—É (X),
    // –∑–∞—Ç–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Ç–µ–º—ã (X.Y)
    function createTicket() {
      return blocks.map((block) => {
        const topicIds = Array.from(
          new Set(
            block.questions.map(q => String(q.number).split(".")[0])
          )
        );
        const topicId = topicIds[Math.floor(Math.random() * topicIds.length)];
        const topicQuestions = block.questions.filter(q =>
          String(q.number).startsWith(topicId + ".")
        );
        const qIndex = Math.floor(Math.random() * topicQuestions.length);
        const question = topicQuestions[qIndex];

        return {
          blockId: block.id,
          blockName: block.name,
          topicId,
          question
        };
      });
    }

    // –†–µ–Ω–¥–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
    function renderTicket(ticket) {
      const container = document.getElementById("ticketContainer");
      container.innerHTML = "";

      if (!ticket || ticket.length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty-state";
        empty.textContent = "–ë–∏–ª–µ—Ç –µ—â—ë –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω.";
        container.appendChild(empty);
        return;
      }

      const blocksWrapper = document.createElement("div");
      blocksWrapper.className = "blocks";

      ticket.forEach((item, idx) => {
        const card = document.createElement("div");
        card.className = "block-card";

        const inner = document.createElement("div");
        inner.className = "block-inner";

        const tag = document.createElement("div");
        tag.className = "block-tag";
        tag.innerHTML = `<span class="block-tag-badge"></span><span>–ë–ª–æ–∫ ${item.blockId}</span>`;

        const subtitle = document.createElement("div");
        subtitle.className = "block-subtitle";
        subtitle.textContent = `–ß–∞—Å—Ç—å ${idx + 1} –∏–∑ 3`;

        const titleRow = document.createElement("div");
        titleRow.className = "block-title-row";

        const title = document.createElement("div");
        title.className = "block-title";
        title.textContent = item.blockName;

        titleRow.appendChild(title);

        const questionEl = document.createElement("div");
        questionEl.className = "question-text";
        questionEl.innerHTML =
          `<span class="question-number">–í–æ–ø—Ä–æ—Å ${item.question.number}.</span> ${item.question.text}`;

        inner.appendChild(tag);
        inner.appendChild(subtitle);
        inner.appendChild(titleRow);
        inner.appendChild(questionEl);

        card.appendChild(inner);
        blocksWrapper.appendChild(card);
      });

      container.appendChild(blocksWrapper);
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –±–∏–ª–µ—Ç–µ
    function updateTicketMeta(ticket, mode, now, durationSec, name) {
      const meta = document.getElementById("ticketMeta");
      const timeStr = now.toLocaleTimeString("ru-RU", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

      let modeLabel;
      if (mode === "instant") {
        modeLabel = "–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è";
      } else if (mode === "roulette-skip") {
        modeLabel = "—Ä—É–ª–µ—Ç–∫–∞ (–¥–æ—Å—Ä–æ—á–Ω—ã–π –≤—ã–±–æ—Ä)";
      } else {
        modeLabel = "—Ä—É–ª–µ—Ç–∫–∞";
      }

      const blocksIds = ticket.map(item => item.blockId).join(" ¬∑ ");
      const questionNumbers = ticket.map(item => item.question.number).join(", ");
      const durationValue = Number(durationSec);
      const hasDuration = mode !== "instant" && Number.isFinite(durationValue) && durationValue > 0;
      const durationPart = hasDuration
        ? `, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä—É–ª–µ—Ç–∫–∏: ${durationValue.toFixed(1)} —Å`
        : "";
      const nameClean = name ? escapeHtml(name) : "";
      const namePart = nameClean ? `, –Ω–∞–∑–≤–∞–Ω–∏–µ: ¬´${nameClean}¬ª` : "";

      meta.innerHTML =
        `<span>–ë–∏–ª–µ—Ç #${ticketCounter} —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤ ${timeStr} (${modeLabel}${durationPart}${namePart}). ` +
        `–ë–ª–æ–∫–∏: ${blocksIds}. –ù–æ–º–µ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤: ${questionNumbers}.</span>`;
    }

    // –î–æ–±–∞–≤–∏—Ç—å –±–∏–ª–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
    function addToHistory(ticket, mode, now, name) {
      const timeStr = now.toLocaleTimeString("ru-RU", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

      const summary = {
        id: ticketCounter,
        time: timeStr,
        mode,
        name: name || "",
        blocksInfo: ticket.map(item => ({
          blockId: item.blockId,
          questionNumber: item.question.number
        }))
      };

      ticketHistory.unshift(summary);
      renderHistory();
    }

    // –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
    function renderHistory() {
      const listEl = document.getElementById("historyList");
      const emptyEl = document.getElementById("historyEmpty");
      if (!listEl || !emptyEl) return;

      if (ticketHistory.length === 0) {
        emptyEl.style.display = "block";
        listEl.innerHTML = "";
        return;
      }

      emptyEl.style.display = "none";
      listEl.innerHTML = "";

      ticketHistory.forEach(item => {
        const row = document.createElement("div");
        row.className = "history-item";

        const header = document.createElement("div");
        header.className = "history-item-header";

        const title = document.createElement("span");
        title.className = "history-item-title";
        title.textContent = `–ë–∏–ª–µ—Ç #${item.id}`;

        const nameEl = document.createElement("span");
        nameEl.className = "history-item-name";
        nameEl.textContent = item.name ? `‚Ä¢ ${item.name}` : "‚Ä¢ –ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";

        const time = document.createElement("span");
        time.className = "history-item-time";
        time.textContent = item.time;

        const mode = document.createElement("span");
        mode.className = "history-item-mode";
        mode.textContent =
          item.mode === "instant"
            ? "–º–≥–Ω–æ–≤–µ–Ω–Ω–æ"
            : item.mode === "roulette-skip"
              ? "—Ä—É–ª–µ—Ç–∫–∞ (–¥–æ—Å—Ä–æ—á–Ω–æ)"
              : "—Ä—É–ª–µ—Ç–∫–∞";

        header.appendChild(title);
        header.appendChild(nameEl);
        header.appendChild(time);
        header.appendChild(mode);

        const renameBtn = document.createElement("button");
        renameBtn.className = "history-rename-btn";
        renameBtn.textContent = "–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å";
        renameBtn.addEventListener("click", () => {
          renameHistoryItem(item.id);
        });
        header.appendChild(renameBtn);

        const blocksRow = document.createElement("div");
        blocksRow.className = "history-item-blocks";

        item.blocksInfo.forEach(info => {
          const pill = document.createElement("span");
          pill.className = "history-pill";
          pill.textContent = `${info.blockId}-${info.questionNumber}`;
          blocksRow.appendChild(pill);
        });

        row.appendChild(header);
        row.appendChild(blocksRow);

        listEl.appendChild(row);
      });
    }

    function renameHistoryItem(id) {
      const entry = ticketHistory.find(h => h.id === id);
      if (!entry) return;
      const newName = prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–∞:", entry.name || "");
      if (newName === null) return;
      const trimmed = newName.trim();
      entry.name = trimmed;
      renderHistory();

      if (currentTicketInfo && currentTicketInfo.id === id) {
        currentTicketName = trimmed;
        currentTicketInfo.name = trimmed;
        if (currentTicket) {
          updateTicketMeta(
            currentTicket,
            currentTicketInfo.mode,
            currentTicketInfo.time,
            currentTicketInfo.durationSec,
            trimmed
          );
        }
      }
    }

    // –§–∏–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç (–æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å, –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—É –∏ –∏—Å—Ç–æ—Ä–∏—é)
    function finalizeTicket(ticket, mode, durationSec, name) {
      currentTicket = ticket;
      currentTicketName = name && name.trim ? name.trim() : "";
      ticketCounter += 1;
      const now = new Date();
      currentTicketInfo = {
        id: ticketCounter,
        mode,
        durationSec,
        time: now,
        name: currentTicketName
      };
      renderTicket(ticket);
      updateTicketMeta(ticket, mode, now, durationSec, currentTicketName);
      addToHistory(ticket, mode, now, currentTicketName);
    }

    // –ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
    function calculateTotalTickets() {
      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä (—Ç–µ–º–∞, –≤–æ–ø—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ —Ç–µ–º—ã) = –ø—Ä–æ—Å—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤.
      // –¢–∞–∫ –∫–∞–∫ –º—ã –≤—Å–µ–≥–¥–∞ –±–µ—Ä—ë–º –≤—Å–µ 3 –±–ª–æ–∫–∞, –∏—Ç–æ–≥–æ ‚Äî –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤.
      return blocks.reduce((acc, block) => acc * block.questions.length, 1);
    }

    function renderStatsBadges() {
      const container = document.getElementById("statsBadges");
      if (!container) return;

      const totalBlocks = blocks.length;
      const totalQuestions = blocks.reduce(
        (sum, block) => sum + block.questions.length,
        0
      );
      const totalTickets = calculateTotalTickets();

      container.innerHTML = "";

      const badgeBlocks = document.createElement("div");
      badgeBlocks.className = "badge";
      badgeBlocks.innerHTML =
        `<span class="badge-label">–±–ª–æ–∫–æ–≤</span><strong>${totalBlocks}</strong>`;

      const badgeQuestions = document.createElement("div");
      badgeQuestions.className = "badge";
      badgeQuestions.innerHTML =
        `<span class="badge-label">–≤–æ–ø—Ä–æ—Å–æ–≤</span><strong>${totalQuestions}</strong>`;

      const badgeTickets = document.createElement("div");
      badgeTickets.className = "badge";
      badgeTickets.innerHTML =
        `<span class="badge-label">–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–∏–ª–µ—Ç–∞</span><strong>${totalTickets.toLocaleString("ru-RU")}</strong>`;

      container.appendChild(badgeBlocks);
      container.appendChild(badgeQuestions);
      container.appendChild(badgeTickets);
    }

    // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ details
    function renderAllQuestions() {
      const container = document.getElementById("allQuestionsContent");
      if (!container) return;

      container.innerHTML = "";

      blocks.forEach(block => {
        const blockDiv = document.createElement("div");
        blockDiv.className = "all-questions-block";

        const title = document.createElement("div");
        title.className = "all-questions-block-title";
        title.textContent = block.name;

        const list = document.createElement("ul");
        list.className = "all-questions-list";

        block.questions.forEach(q => {
          const li = document.createElement("li");
          li.innerHTML =
            `<span class="question-number-tag">${q.number}.</span>${q.text}`;
          list.appendChild(li);
        });

        blockDiv.appendChild(title);
        blockDiv.appendChild(list);
        container.appendChild(blockDiv);
      });
    }

    // –ó–∞–ø—É—Å–∫ —Ä—É–ª–µ—Ç–∫–∏ (–æ—Å—Ç–∞–≤–ª—è–µ–º –ª–æ–≥–∏–∫—É –ø–æ –±–ª–æ–∫–∞–º –∫–∞–∫ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –∏—Ç–æ–≥–æ–≤—ã–π –±–∏–ª–µ—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —á–µ—Å—Ç–Ω–æ —Å—Ç—Ä–æ–∏—Ç—Å—è)
    function startRoulette(durationSec, ticketName) {
      if (rouletteState) {
        return;
      }

      const baseDurationMs = Math.max(1, Number(durationSec) || 1) * 1000;
      const baseDurationLabel = (baseDurationMs / 1000).toFixed(1);
      const blocksToPick = Math.min(3, blocks.length);
      const totalStages = blocksToPick * 2;

      const overlay = document.createElement("div");
      overlay.className = "roulette-overlay";

      overlay.innerHTML = `
        <div class="roulette-panel">
          <div class="roulette-header">
            <div>
              <div class="roulette-title">
                <span>üé∞</span>
                <span id="rouletteStageTitle">–†—É–ª–µ—Ç–∫–∞ –±–∏–ª–µ—Ç–æ–≤</span>
              </div>
              <div class="roulette-subtitle">
                <span id="rouletteStageText">–°–µ–π—á–∞—Å –≤—ã–±–∏—Ä–∞–µ–º –±–ª–æ–∫.</span>
                <span> –û—Å—Ç–∞–ª–æ—Å—å <strong><span id="rouletteCountdown">${baseDurationLabel}</span> —Å</strong></span>
              </div>
            </div>
            <div class="roulette-progress">
              <div class="progress-label">
                <span id="rouletteProgressLabel">–≠—Ç–∞–ø 1 / ${totalStages}</span>
                <span id="rouletteCountdownSmall">${baseDurationLabel} —Å</span>
              </div>
              <div class="progress-bar">
                <div class="progress-inner" id="rouletteProgress"></div>
              </div>
            </div>
          </div>
          <div class="roulette-stage-label" id="rouletteStageLabel">–ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –±–ª–æ–∫–∏</div>
          <div class="roulette-picked" id="roulettePicked"></div>
          <div class="roulette-grid" id="rouletteGrid"></div>
          <div class="roulette-actions">
            <div class="roulette-hint" id="rouletteHint">
              –ú–æ–∂–Ω–æ –¥–æ—Å—Ä–æ—á–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–∞–ø ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç. –ù–∞–∂–∞—Ç–∏–µ –≤–Ω–µ –æ–∫–Ω–∞ –æ—Ç–º–µ–Ω–∏—Ç –≤—Å—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é.
            </div>
            <div class="roulette-actions-right">
              <button class="btn-ghost" id="rouletteCancelBtn">
                <span class="btn-icon">‚úï</span>
                –û—Ç–º–µ–Ω–∞
              </button>
              <button class="btn-secondary" id="rouletteSkipBtn">
                <span class="btn-icon">‚è©</span>
                –í—ã–±—Ä–∞—Ç—å —Å–µ–π—á–∞—Å
              </button>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(overlay);

      const gridEl = overlay.querySelector("#rouletteGrid");
      const countdownEl = overlay.querySelector("#rouletteCountdown");
      const countdownSmallEl = overlay.querySelector("#rouletteCountdownSmall");
      const progressInner = overlay.querySelector("#rouletteProgress");
      const progressLabelEl = overlay.querySelector("#rouletteProgressLabel");
      const stageTitleEl = overlay.querySelector("#rouletteStageTitle");
      const stageTextEl = overlay.querySelector("#rouletteStageText");
      const stageLabelEl = overlay.querySelector("#rouletteStageLabel");
      const pickedEl = overlay.querySelector("#roulettePicked");
      const cancelBtn = overlay.querySelector("#rouletteCancelBtn");
      const skipBtn = overlay.querySelector("#rouletteSkipBtn");
      const hintEl = overlay.querySelector("#rouletteHint");

      const state = {
        cancelRequested: false,
        skipUsed: false,
        cleanupStage: null,
        finishStageEarly: null
      };
      rouletteState = state;

      const availableBlocks = blocks.slice();
      const ticket = [];
      const startedAt = performance.now();

      function cleanupOverlay() {
        overlay.classList.add("roulette-overlay-fade-out");
        setTimeout(() => {
          overlay.remove();
        }, 160);
      }

      function cancelRoulette() {
        if (state.cancelRequested) return;
        state.cancelRequested = true;
        if (state.cleanupStage) {
          state.cleanupStage();
        }
        cleanupOverlay();
        rouletteState = null;
      }

      cancelBtn?.addEventListener("click", cancelRoulette);
      overlay.addEventListener("click", (event) => {
        if (event.target === overlay) {
          cancelRoulette();
        }
      });
      skipBtn?.addEventListener("click", () => {
        if (state.finishStageEarly) {
          state.finishStageEarly();
        }
      });

      function formatSeconds(ms) {
        return (ms / 1000).toFixed(1);
      }

      function updatePicked() {
        if (!pickedEl) return;
        pickedEl.innerHTML = "";
        ticket.forEach(item => {
          const pill = document.createElement("div");
          pill.className = "roulette-picked-pill";
          pill.innerHTML = `<strong>${item.blockId}</strong><span>–í–æ–ø—Ä–æ—Å ${item.question.number}</span>`;
          pickedEl.appendChild(pill);
        });
      }

      function setStageInfo(stageType, block, stageNumber) {
        const display = formatSeconds(baseDurationMs);
        const blockLabel = block ? block.id : "?";
        if (stageTitleEl) {
          const partIndex = ticket.length + 1;
          stageTitleEl.textContent =
            stageType === "block"
              ? `–í—ã–±–æ—Ä –±–ª–æ–∫–∞ ${partIndex} –∏–∑ ${blocksToPick}`
              : `–í–æ–ø—Ä–æ—Å –¥–ª—è –±–ª–æ–∫–∞ ${blockLabel}`;
        }
        if (stageTextEl) {
          stageTextEl.textContent =
            stageType === "block"
              ? "–ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –±–ª–æ–∫–∞ –∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è."
              : `–ë–ª–æ–∫ ${blockLabel} –≤—ã–±—Ä–∞–Ω, –≤—ã–±–∏—Ä–∞–µ–º –≤–æ–ø—Ä–æ—Å.`;
        }
        if (stageLabelEl) {
          stageLabelEl.textContent =
            stageType === "block"
              ? "–í—ã–±–∏—Ä–∞–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ–π –±–ª–æ–∫ (–±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π)"
              : `–í—ã–±–∏—Ä–∞–µ–º –≤–æ–ø—Ä–æ—Å –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ ${blockLabel}`;
        }
        if (progressLabelEl) {
          progressLabelEl.textContent = `–≠—Ç–∞–ø ${stageNumber} / ${totalStages}`;
        }
        if (countdownEl) countdownEl.textContent = display;
        if (countdownSmallEl) countdownSmallEl.textContent = `${display} —Å`;
        if (progressInner) progressInner.style.transform = "scaleX(1)";
        if (hintEl) {
          hintEl.textContent =
            stageType === "block"
              ? "–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–∞–ø ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–π –±–ª–æ–∫. –ö–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞ –æ—Ç–º–µ–Ω–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é."
              : "–ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–∞–ø ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –ö–ª–∏–∫ –≤–Ω–µ –æ–∫–Ω–∞ –æ—Ç–º–µ–Ω–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é.";
        }
      }

      function buildCard(item, stageType) {
        const card = document.createElement("div");
        card.className = "mini-ticket";

        if (stageType === "block") {
          card.innerHTML = `
            <div class="mini-ticket-title">–ë–ª–æ–∫ ${item.id}</div>
            <div class="mini-ticket-blocks">${item.name}</div>
            <div class="mini-ticket-questions">–í–æ–ø—Ä–æ—Å–æ–≤: ${item.questions.length}</div>
          `;
        } else {
          card.innerHTML = `
            <div class="mini-ticket-title">–í–æ–ø—Ä–æ—Å ${item.number}</div>
            <div class="mini-ticket-questions">${item.text}</div>
          `;
        }

        return card;
      }

      function runStage({ stageType, items, block, stageNumber }) {
        return new Promise((resolve, reject) => {
          if (!gridEl || !items || items.length === 0) {
            reject(new Error("–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏"));
            return;
          }

          setStageInfo(stageType, block, stageNumber);
          gridEl.innerHTML = "";

          const cards = items.map(item => {
            const card = buildCard(item, stageType);
            gridEl.appendChild(card);
            return card;
          });

          let activeIndex = -1;
          function setActive(index) {
            if (cards.length === 0) return;
            if (activeIndex >= 0 && cards[activeIndex]) {
              cards[activeIndex].classList.remove("is-hot");
            }
            activeIndex = index;
            if (cards[activeIndex]) {
              cards[activeIndex].classList.add("is-hot");
            }
          }

          if (cards.length > 0) {
            const initialIndex = Math.floor(Math.random() * cards.length);
            setActive(initialIndex);
          }

          const tickInterval = 250;
          const intervalId = setInterval(() => {
            if (cards.length === 0) return;
            const nextIndex = Math.floor(Math.random() * cards.length);
            setActive(nextIndex);
          }, tickInterval);

          const start = performance.now();
          const end = start + baseDurationMs;
          let rafId = null;
          let done = false;

          function finish(early) {
            if (done || state.cancelRequested) return;
            done = true;
            state.finishStageEarly = null;
            state.cleanupStage = null;
            clearInterval(intervalId);
            if (rafId !== null) {
              cancelAnimationFrame(rafId);
            }

            if (countdownEl) countdownEl.textContent = "0.0";
            if (countdownSmallEl) countdownSmallEl.textContent = "0.0 —Å";
            if (progressInner) progressInner.style.transform = "scaleX(0)";

            const chosenIndex = activeIndex >= 0 ? activeIndex : 0;
            const chosen = items[chosenIndex] || items[0];
            if (early) {
              state.skipUsed = true;
            }
            resolve(chosen);
          }

          function step(now) {
            if (done || state.cancelRequested) return;
            const remaining = end - now;
            const clampedRemaining = Math.max(0, remaining);
            const fraction = clampedRemaining / baseDurationMs;
            const seconds = clampedRemaining / 1000;

            const display = seconds.toFixed(1);
            if (countdownEl) countdownEl.textContent = display;
            if (countdownSmallEl) countdownSmallEl.textContent = display + " —Å";
            if (progressInner) progressInner.style.transform = `scaleX(${fraction})`;

            if (remaining <= 0) {
              finish(false);
            } else {
              rafId = requestAnimationFrame(step);
            }
          }

          state.finishStageEarly = () => finish(true);
          state.cleanupStage = () => {
            if (done) return;
            done = true;
            clearInterval(intervalId);
            if (rafId !== null) {
              cancelAnimationFrame(rafId);
            }
            reject(new Error("cancelled"));
          };

          rafId = requestAnimationFrame(step);
        });
      }

      updatePicked();

      (async () => {
        try {
          while (ticket.length < blocksToPick && availableBlocks.length > 0) {
            if (state.cancelRequested) return;

            const stageNumber = ticket.length * 2 + 1;
            const block = await runStage({
              stageType: "block",
              items: availableBlocks,
              stageNumber
            });

            if (state.cancelRequested) return;

            // –≤–Ω—É—Ç—Ä–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ —á–µ—Å—Ç–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º —Ç–µ–º—É –∏ –≤–æ–ø—Ä–æ—Å —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ createTicket
            const topicIds = Array.from(
              new Set(block.questions.map(q => String(q.number).split(".")[0]))
            );
            const topicId = topicIds[Math.floor(Math.random() * topicIds.length)];
            const topicQuestions = block.questions.filter(q =>
              String(q.number).startsWith(topicId + ".")
            );

            const question = await runStage({
              stageType: "question",
              items: topicQuestions,
              block,
              stageNumber: stageNumber + 1
            });

            if (state.cancelRequested) return;

            ticket.push({
              blockId: block.id,
              blockName: block.name,
              topicId,
              question
            });
            const blockIndex = availableBlocks.findIndex(b => b.id === block.id);
            if (blockIndex >= 0) {
              availableBlocks.splice(blockIndex, 1);
            }
            updatePicked();
          }

          if (state.cancelRequested || ticket.length === 0) {
            return;
          }

          const totalDurationSec = (performance.now() - startedAt) / 1000;
          cleanupOverlay();
          rouletteState = null;

          const modeLabel = state.skipUsed ? "roulette-skip" : "roulette";
          finalizeTicket(ticket, modeLabel, Number(totalDurationSec.toFixed(1)), ticketName);
        } catch (error) {
          if (!state.cancelRequested) {
            cleanupOverlay();
            rouletteState = null;
          }
        }
      })();
    }

    // –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–∞
    function generateInstant(name) {
      const ticket = createTicket();
      finalizeTicket(ticket, "instant", 0, name);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (function init() {
      const generateBtn = document.getElementById("generateBtn");
      const durationRange = document.getElementById("durationRange");
      const durationLabel = document.getElementById("durationLabel");
      const instantBtn = document.getElementById("instantBtn");
      const ticketNameInput = document.getElementById("ticketNameInput");

      if (generateBtn) {
        generateBtn.addEventListener("click", () => {
          const sec = durationRange ? parseInt(durationRange.value, 10) || 5 : 5;
          const name = ticketNameInput?.value || "";
          startRoulette(sec, name);
        });
      }

      if (instantBtn) {
        instantBtn.addEventListener("click", () => {
          const name = ticketNameInput?.value || "";
          generateInstant(name);
        });
      }

      if (durationRange && durationLabel) {
        durationLabel.textContent = durationRange.value;
        durationRange.addEventListener("input", () => {
          durationLabel.textContent = durationRange.value;
        });
      }

      renderStatsBadges();
      renderAllQuestions();
      renderHistory();
    })();
  </script>
</body>

</html>
